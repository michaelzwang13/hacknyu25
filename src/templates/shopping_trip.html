<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Shopping Trip</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 1rem;
      }
      .section-container {
        margin-bottom: 2rem;
      }
      h2 {
        color: #007bff;
      }
      .form-group {
        margin-bottom: 1rem;
      }
      label {
        display: inline-block;
        width: 100px;
        font-weight: 600;
      }
      input[type="text"],
      input[type="number"] {
        padding: 0.4rem;
        font-size: 1rem;
        width: 200px;
        margin-bottom: 0.5rem;
      }
      button {
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
      button:hover {
        background-color: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }
      thead {
        background-color: #f4f4f4;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 0.5rem;
      }
      .finish-btn {
        margin-top: 1rem;
        background-color: #28a745;
      }
      .finish-btn:hover {
        background-color: #218838;
      }
    </style>
  </head>
  <body>
    <!-- If NO existing cart session -->
    {% if not cart_session %}
    <section class="section-container">
      <h2>Start a New Shopping Trip</h2>
      <form action="/start-shopping" method="POST">
        <div class="form-group">
          <label for="storeName">Store Name:</label>
          <input
            type="text"
            id="storeName"
            name="storeName"
            placeholder="e.g. Walmart, Costco"
            required
          />
        </div>
        <button type="submit">Start Shopping</button>
      </form>
    </section>

    {% else %}
    <!-- If there IS an existing cart session -->
    <section class="section-container">
      <h2>Current Shopping Trip</h2>
      <p><strong>Store:</strong> {{ cart_session.store_name }}</p>
      <p><strong>Status:</strong> Active</p>
    </section>

    <section class="section-container">
      <h3>Add an Item</h3>
      <form action="/shopping-trip/add-item" method="POST">
        <div>
          <label for="upc">Barcode Number:</label>
          <input type="number" id="upc" name="upc" required />
        </div>
        <div class="form-group">
          <label for="itemPrice">Price:</label>
          <input
            type="number"
            step="0.01"
            min="0"
            max="999999.99"
            id="itemPrice"
            name="itemPrice"
            placeholder="0.00"
            required
          />
        </div>
        <div class="form-group">
          <label for="itemQty">Quantity:</label>
          <input
            type="number"
            id="itemQty"
            name="itemQty"
            min="1"
            value="1"
            required
          />
        </div>
        <button type="submit">Add to Cart</button>
      </form>
    </section>

    <section class="section-container">
      <h3>Current Cart Items</h3>
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% if cart_items %} {% for item in cart_items %}
          <tr>
            <td>{{ item.name }}</td>
            <td>\${{ item.price }}</td>
            <td>{{ item.quantity }}</td>
            <td>\${{ item.price * item.quantity }}</td>
          </tr>
          {% endfor %} {% else %}
          <tr>
            <td colspan="4" style="text-align: center">No items yet.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </section>

    <section class="section-container">
      <h3>Budget Overview</h3>
      <p><strong>Allocated Budget:</strong> \${{ allocated_budget }}</p>
      <p><strong>Current Spend:</strong> \${{ current_spend }}</p>
      <p>
        <strong>Remaining:</strong> \${{ allocated_budget - current_spend }}
      </p>
    </section>

    <section class="section-container">
      <form action="/finish-shopping" method="POST">
        <button type="submit" class="finish-btn">Finish Shopping</button>
      </form>
    </section>
    {% endif %}
  </body>
</html>
